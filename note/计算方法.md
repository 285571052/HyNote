# 计算方法

## 误差

### 误差来源

1. 模型误差
2. 观测误差：受限于测量工具的精度
3. 方法误差：所求是模型的近似解
4. 舍入误差：计算机精度有限

### 误差的定义

误差=近似值-准确值,
记作:

$$e^* = x^* - x$$

误差，又叫绝对误差

### 误差限

误差限：一般情况下，准确值$x$是未知的，因此误差$e^*$的准确值是无法求出的，但有时而已根据具体测量或计算出误差的绝对值不可能超过某个整数，这个整数称为 **误差限**

定义：若$|e^*| = |x^* - x| \leq \epsilon^*$ ，则称$\epsilon^*$为近似值$x^*$的误差限， 近似值$x^*$的误差限也记作 $\epsilon(x^*)$

### 有效数字 P13 句2

定义1：若近似值$x^*$的误差限为该值的某一位的半个单位，且从该为开始往左数到第一位非0数字共有$n$位，则称 $x^*$具有n为有效数字

而对任何数值经过四舍五入之后得到的近似值，它的误差限是它末位的半个单位，因此只需要从后往左数即可

<br>
例子：$\pi$的近似值3.1415有多少位有效数字？

$$|3.1415 - x| < 0.5 \times 10^{-3}$$

从$10^-3$位开始往前数到第一个非0数字，共有4位， 因此3.1415有4位有效数字

$\pi$四舍五入后的值是3.1416，因此在计算3.1415的有效数字位数的时候不能直接从末位往前数

注：$\pi$ 的准确值有无穷多位有效数字

<br>
有效数字与误差限的关系（定义2）：

设$x^*$为准确值$x$的近似值，且将$x^*$表示为

$$x^* = \pm 0.a_1a_2\cdots a^m \times 10^p$$

p为整数,$a_1,a_2\cdots ,a^m$为$0\sim 9$之间的数字，且$a_1\neq 0$，若有
$$|x^* - x| < 0.5 \times 10^{p - n}$$
则近似值$x^*$有$n$位有效数字

概括地说，总长p位，有效数字为n位，其误差限为$0.5\times 10^{p - n}$

### 相对误差

因为量纲等问题， 误差的大小并不能真正反映出错误的程度，所以考虑“单位误差”即 **相对误差**

定义：$$相对误差 = \frac{绝对误差}{准确值}$$

由于 准确值 往往是未知的，因此采用近似值近似计算

$$相对误差 = \frac{绝对误差}{准确值} \approx \frac{绝对误差}{近似值}$$

即

$$e_r^* = \frac{e^*}{x} \approx \frac{e^*}{x^*} = \frac{x^* - x}{x^*} $$

但，只有在$\frac{e^*}{x^*}\to 0$的条件下才可以用

<br>
证明:当$\frac{e^*}{x^*}\to 0$时，
$$\frac{e^*}{x} = \frac{e^*}{x^*}$$

证明思路：作差，消去$x$
$$\lim_{\frac{e^*}{x^*}\to 0}\left |\frac{e^*}{x^*} - \frac{e^*}{x}\right | = \left | e^*\frac{x^* - x}{xx^*} \right | = \left | \frac{(e^*)^2}{xx^*} \right |  = \left | \frac{(e^*)^2}{(x^* - e^*)x^*} \right | = \left | \frac{(\frac{e^*}{x^*})^2}{1 - \frac{e^*}{x^*}} \right | = 0$$

### 相对误差限

定义：
$$|e_r^*| = \left | \frac{x^* - x}{x^*} \right | \leq \frac{\epsilon^*}{|x^*|}$$
则相对误差限为(误差除以近似值的绝对值)
$$\epsilon_r^* = \frac{\epsilon^*}{|x^*|}$$

<br>
相对误差限与有效数字的关系:

若近似值$x^* = \pm 0.a_1a_2\cdots a_m \times 10^p$有n位有效数字($n\leq m$)，其相对误差限为？

n为有效数字， 其误差限$\epsilon^*$为：
$$|e^*| = |x - x^*| \leq \epsilon^* = \frac{1}{2} \times 10^{p - n}$$

$$\left |\frac{x - x^*}{x^*}\right| \leq \frac{\epsilon^*}{|x^*|} = \frac{10^{p - n}}{2\times 0.a_1a_2\cdots a_m \times 10^p} = \frac{10^{ - n}}{2\times 0.a_1a_2\cdots a_m } \leq \frac{10^{1 - n}}{2a_1}  $$

<br>
若近似数$x^* = \pm 0.a_1a_2\cdots a_m \times 10^p$,且相对误差限满足关系式
$$\epsilon_r^* \leq \frac{1}{2(a_2 + 1)} \times 10^{-(n - 1)}$$
则 $x^*$有多少位有效数字？

$$\begin{array}{ll}
\epsilon_r^* &= \frac{\epsilon^*}{|x^*|} \leq \frac{1}{2(a_2 + 1)} \times 10^{-(n - 1)}\\
\epsilon^* &\leq |x^*|\times \frac{1}{2(a_2 + 1)} \times 10^{-(n - 1)} \\
&=0.a_1a_2\cdots a_m \times 10^p \times \frac{1}{2(a_2 + 1)} \times 10^{-(n - 1)}\\
&=(a + 0.a_2\cdots a_m)\times 10^{p - 1} \times \frac{1}{2(a_2 + 1)} \times 10^{-(n - 1)}\\
&\leq (a + 1)\times 10^{p - 1} \times \frac{1}{2(a_2 + 1)} \times 10^{-(n - 1)}\\
&= \frac{1}{2} \times 10^{p - n}
 \end{array}$$

 因此有n位有效数字

### 误差传递

误差传递：数值运算过程中的误差估计，使用$x^*$代替准确值$x$进行计算 ，则$f(x)$必定存在误差

思路：使用f(x) 在 $x^*$ 的taylor展开作为 f(x) 准确值的计算（只取到线性项，忽略余项），由此构造误差进行分析

$f(x)$在$x^*$附近的taylor展开：
$$f(x) = f(x^*) + f'(x^*)(x - x^*)$$
绝对误差：
$$e(f(x^*)) = f(x^*) - f(x) = f'(x^*)(x^* - x) = f'(x^*)e(x^*)$$
相对误差：
$$e_r(f(x^*)) \approx \frac{e(f(x^*))}{f(x^*)} = \frac{f'(x^*)}{f(x^*)}e(x^*)$$
误差限：
$$ |f(x) - f(x^*)| = |f'(x^*)e(x^*)| = |f'(x^*)||e(x^*)| \leq |f'(x^*)| \epsilon(x^*) = \epsilon(f(x^*))$$
相对误差限:
$$ \epsilon_r(f(x^*)) \approx \frac{\epsilon(f(x^*))}{|f(x^*)|} = \left |\frac{f'(x^*)}{f(x^*)} \right | \epsilon(x^*)$$

<br>
二元taylor展开：（偏导）
$$\begin{array}{ll}
f(x , y) &= f(x^*,y^*) + \frac{\partial f(x^* , y^*)}{\partial x}(x - x^*) + \frac{\partial f(x^* , y^*)}{\partial y}(y - y^*)\\
&=f(x^*,y^*) + f_x'(x^*,y^*)(x - x^*) + f_y'(x^*,y^*)(y - y^*)\\
&= f(x^*,y^*) + f_x'(x - x^*) + f_y'(y - y^*)
\end{array}$$
绝对误差：
$$e(f(x^*,y^*)) = f(x^*,y^*) - f(x , y) = f_x'(x^* - x) + f_y'(y^* - y) = f_x'e(x^*) + f_y'e(y^*)$$
相对误差：
$$\begin{array}{ll}
e_r(f(x^*,y^*)) &\approx \frac{e(f(x^*,y^*))}{f(x^*,y^*)} =\frac{ f(x^*,y^*) - f(x , y)}{f(x^*,y^*)} \\&= \frac{f_x'}{f(x^*,y^*)}(x^* - x) + \frac{f_y'}{f(x^*,y^*)}(y^* - y) \\&= \frac{f_x'}{f(x^*,y^*)}e(x^*) + \frac{f_y'}{f(x^*,y^*)}e(y^*)
\end{array}$$
误差限：
$$|e(f(x^*,y^*))| = |f_x'(x - x^*) + f_y'(y - y^*)| \leq |f_x'|\epsilon(x^*) + |f_y'|\epsilon(y^*) = \epsilon(f(x^*,y^*))$$
相对误差限：
$$\epsilon_r(f(x^*,y^*)) \approx \frac{\epsilon(f(x^*,y^*))}{f(x^*,y^*)}=\left |\frac{f_x'}{f(x^*,y^*)}\right |\epsilon(x^*) + \left | \frac{f_y'}{f(x^*,y^*)}\right |\epsilon(y^*) $$

### 数值计算中应该注意的问题

1. 避免两个相近的数相减--??????课本的貌似是相对误差 ， 不知道推导是否正确
    $$\epsilon_r(x^*-y^*) = \frac{\epsilon(x^*) + \epsilon(x^*)}{|x^* - y^*|}$$

2. 防止大数吃小数

3. 减少运算的次数

4. 避免做除数绝对值远小于被除数绝对值的除法
    1. 结果可能溢出
    2. 舍入误差严重增大

5. 选择数值稳定的计算公式

    给定$I_n = \int_0^1 x^ne^{x- 1}dx$，可以用公式$I_n = 1 - n I_{n - 1}$计算，有两个递推方向：正推(已知$I_n$递推出$I_{n - 1}$)，逆推(已知$I_n$递推出$I_{n + 1}$)

    1. 从$I_0$正推出$I_n$

        近似值：
        $$I_n^* = 1 - nI_{n - 1}^*$$

        $$\begin{array}{ll}
        e(I_n^*) &= I_n^* - I_n = ( 1 - nI_{n - 1}^*) - ( 1 - nI_{n - 1}) = -n(I^*_{n - 1} - I_{n - 1})\\
        &= \cdots\\
        &= (-1)^nn!(I_0^* - I_0)
        \end{array}$$

        可以看出误差呈“阶乘式”增长

    2. 从$I_n$逆推出$I_0$

        近似值:
        $$I_{n - 1}^* =  \frac{1 - I^*_n}{n}$$

        $$I_{n - 1}^* - I_{n - 1} = \frac{-1}{n}(I_n^* - I_n)$$

        $$\Rightarrow I_0^* - I_0 = \frac{(-1)^n}{n!}(I_n^* - I_n)$$

        逆推的时候，可以看出误差传播逐步减少

## 插值