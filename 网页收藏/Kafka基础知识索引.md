# Kafka基础知识索引

Kafka不仅仅是一个队列，而且是一个存储，有超强的堆积能力。Kafka不仅用在吞吐量高的大数据场景，也可以用在有事务要求的业务系统上，但性能较低。Kafka不是Topic越多越好，由于其设计原理，在数量达到阈值后，其性能和Topic数量成反比。

考虑订单的业务场景，有大量的请求指向我们的业务系统，如果直接经过复杂的业务逻辑进入业务表，将会有大量请求超时失败。所以我们加入了一张中间缓冲表（或者Redis），用来承接用户的请求。然后，有一个定时任务，不断的从缓冲表中获取数据，进行真正的业务逻辑处理

这种设计有以下几个问题：定时任务的轮询间隔不好控制。业务处理容易延迟。无法横向扩容处理能力，且会引入分布式锁、顺序性保证等问题。当其他业务也需要这些订单数据的时候，业务逻辑就必须要加入到定时任务里。
当访问量增加、业务逻辑复杂化的时候，消息队列就呼之欲出了。

消息系统的作用:

1. 削峰
2. 缓冲
3. 解耦
4. 冗余
5. 健壮性

消息系统要求:

1. 性能要高
2. 消息要可靠
3. 一般通过增加副本，强制刷盘来解决
4. 扩展性要好
5. 生态成熟

Kafka是一个分布式消息(存储）系统。分布式系统通过分片增加并行度；通过副本增加可靠性

分布式系统保证数据可靠性的一个常用手段就是增加副本个数，ISR就是建立在这个手段上

ISR全称”In-Sync Replicas”，是保证HA和一致性的重要机制。副本数对Kafka的吞吐率是有一定的影响，但极大的增强了可用性。一般2-3个为宜。

N个replicas中，其中一个replica为leader，其他都为follower, leader处理partition的所有读写请求，其他的都是备份。与此同时，follower会被动定期地去复制leader上的数据。

如果一个flower比一个leader落后太多，或者超过一定时间未发起数据复制请求，则leader将其重ISR中移除

当ISR中所有Replica都向Leader发送ACK时，leader才commit。

当Leader节点失效，也会依赖Zk进行新的Leader选举。

[Kafka基础知识索引][1]

[1]:https://mp.weixin.qq.com/s/MKiFehA4EHTv1o23A28Jyg
